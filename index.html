<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>W√§hrungsrechner - Sunset</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí±</text></svg>">
    <style>
        :root {
            --primary-color: #ea580c; /* Kr√§ftiges Orange */
            --primary-dark: #c2410c;
            --text-color: #431407;    /* Sehr dunkles Braun f√ºr Kontrast */
            --text-muted: #9a3412;    /* Ged√§mpftes Rostrot */
            --border-radius: 30px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Inter', system-ui, sans-serif; }

        body {
            /* Sunset Farbverlauf: Von Sonnengelb zu warmem Orange */
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            background-attachment: fixed;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            color: var(--text-color);
            padding: 1rem;
        }

        .converter-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.9);
            width: 100%;
            max-width: 450px;
            padding: 2.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px 0 rgba(234, 88, 12, 0.15);
        }

        .header { text-align: center; margin-bottom: 2rem; }
        .header h1 { font-size: 2rem; font-weight: 800; color: var(--text-color); letter-spacing: -1px;}
        
        .input-wrapper { margin-bottom: 1rem; }
        .label { display: block; font-size: 0.75rem; font-weight: 700; color: var(--text-muted); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 0.5px; opacity: 0.9;}
        
        .amount-input {
            width: 100%; padding: 1.2rem; font-size: 1.8rem; font-weight: 700; color: var(--text-color);
            background: rgba(255,255,255,0.6);
            border: 2px solid transparent; border-radius: 20px; outline: none; transition: all 0.3s;
        }
        .amount-input:focus { background: white; box-shadow: 0 4px 15px rgba(234, 88, 12, 0.2); border-color: rgba(234, 88, 12, 0.1); }

        .controls-row { display: grid; grid-template-columns: 1fr auto 1fr; gap: 10px; align-items: end; margin-bottom: 1.5rem; }

        select {
            width: 100%; padding: 0.9rem; border-radius: 16px; 
            border: none; background-color: rgba(255,255,255,0.6);
            font-weight: 600; cursor: pointer; outline: none; color: var(--text-color);
            transition: 0.2s;
        }
        select:focus { background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        .swap-btn {
            width: 45px; height: 45px; border-radius: 50%; border: none;
            background: rgba(255,255,255,0.6); color: var(--primary-color); cursor: pointer; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s; margin-bottom: 3px;
        }
        .swap-btn:hover { background: white; transform: rotate(180deg) scale(1.1); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }

        .favorites-section { margin-bottom: 2rem; text-align: center; }
        .favorites-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 0.5rem; }

        .fav-btn {
            background: rgba(255, 255, 255, 0.5); border: 1px solid rgba(255,255,255,0.8);
            color: var(--primary-color); padding: 0.8rem; border-radius: 15px; font-size: 0.8rem; font-weight: 700;
            cursor: pointer; transition: all 0.2s;
        }
        .fav-btn:hover { background: white; transform: translateY(-2px); box-shadow: 0 4px 10px rgba(234, 88, 12, 0.15); border-color: var(--primary-color); }

        /* Ergebnis-Box: Nur Rahmen statt F√ºllung */
        .result-box {
            background: rgba(255, 255, 255, 0.4); 
            border: 2px solid var(--primary-color); 
            border-radius: 24px; padding: 2rem; 
            color: var(--text-color); text-align: center;
            margin-bottom: 2rem; position: relative; overflow: hidden;
            box-shadow: 0 4px 15px rgba(234, 88, 12, 0.05);
        }
        .result-box.loading { opacity: 0.6; }
        .result-amount { font-size: 2.2rem; font-weight: 800; color: var(--primary-dark); }
        .result-label { font-size: 0.95rem; opacity: 0.9; font-weight: 600; }
        
        /* Style f√ºr den Geb√ºhren-Text */
        .wise-fee-text {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.5rem;
            font-weight: 600;
            opacity: 0.9;
        }

        .history-section { border-top: 1px solid rgba(154, 52, 18, 0.1); padding-top: 1.5rem; }
        .history-title { font-size: 0.85rem; font-weight: 700; color: var(--text-muted); margin-bottom: 1rem; text-transform: uppercase; letter-spacing: 0.05em; opacity: 0.8;}
        .history-list { list-style: none; }
        .history-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.8rem 0; border-bottom: 1px solid rgba(154, 52, 18, 0.05); font-size: 0.9rem;
            animation: fadeIn 0.3s ease-in; color: var(--text-color);
        }
        .history-item:last-child { border-bottom: none; }
        .history-date { font-size: 0.75rem; color: var(--text-muted); opacity: 0.6; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        .error-msg { display: none; color: #c2410c; font-size: 0.85rem; text-align: center; margin-top: 1rem; font-weight: bold; }
    </style>
</head>
<body>
    <div class="converter-card">
        <div class="header">
            <h1>Umrechnen!</h1>
        </div>
        <div class="input-wrapper">
            <label class="label">Betrag</label>
            <input type="number" id="amount" class="amount-input" value="1" placeholder="0.00">
        </div>
        <div class="controls-row">
            <div>
                <label class="label">Von</label>
                <select id="from-currency">
                    <option value="EUR">&#127466;&#127482; EUR</option>
                    <option value="CZK" selected>&#127464;&#127487; CZK</option>
                    <option value="USD">&#127482;&#127480; USD</option>
                    <option value="HUF">&#127469;&#127482; HUF</option>
                    <option value="GBP">&#127468;&#127463; GBP</option>
                    <option value="ZAR">&#127487;&#127462; ZAR</option>
                    <option value="CHF">&#127464;&#127469; CHF</option>
                    <option value="JPY">&#127471;&#127477; JPY</option>
                </select>
            </div>
            <button class="swap-btn" id="swap-btn" title="Tauschen">&#8644;</button>
            <div>
                <label class="label">Zu</label>
                <select id="to-currency">
                    <option value="EUR" selected>&#127466;&#127482; EUR</option>
                    <option value="CZK">&#127464;&#127487; CZK</option>
                    <option value="USD">&#127482;&#127480; USD</option>
                    <option value="HUF">&#127469;&#127482; HUF</option>
                    <option value="GBP">&#127468;&#127463; GBP</option>
                    <option value="ZAR">&#127487;&#127462; ZAR</option>
                    <option value="CHF">&#127464;&#127469; CHF</option>
                    <option value="JPY">&#127471;&#127477; JPY</option>
                </select>
            </div>
        </div>
        <div class="favorites-section">
            <div class="label">Schnellwahl</div>
            <div class="favorites-grid">
                <button class="fav-btn" onclick="setFavorite('CZK', 'EUR')">CZK &#8644; EUR</button>
                <button class="fav-btn" onclick="setFavorite('ZAR', 'EUR')">ZAR &#8644; EUR</button>
                <button class="fav-btn" onclick="setFavorite('GBP', 'EUR')">GBP &#8644; EUR</button>
            </div>
        </div>
        
        <div class="result-box" id="result-box">
            <p class="result-label" id="conversion-text">1,00 EUR =</p>
            <div class="result-amount" id="result-amount">...</div>
            <p class="wise-fee-text" id="wise-fee-text"></p>
        </div>

        <div id="error-msg" class="error-msg">Fehler beim Laden.</div>
        <div class="history-section">
            <div class="history-title">Letzte Konvertierungen</div>
            <ul class="history-list" id="history-list"></ul>
        </div>
    </div>
    <script>
        const amountInput = document.getElementById('amount');
        const fromSelect = document.getElementById('from-currency');
        const toSelect = document.getElementById('to-currency');
        const swapBtn = document.getElementById('swap-btn');
        const resultBox = document.getElementById('result-box');
        const resultAmount = document.getElementById('result-amount');
        const conversionText = document.getElementById('conversion-text');
        const wiseFeeText = document.getElementById('wise-fee-text');
        const errorMsg = document.getElementById('error-msg');
        const historyListEl = document.getElementById('history-list');
        let debounceTimer;
        let conversionHistory = JSON.parse(localStorage.getItem('fx_history')) || [];
        
        // ZENTRALE FORMATIERUNGSFUNKTION
        // Erzwingt de-DE (Tausenderpunkt, Dezimalkomma) und genau 2 Nachkommastellen
        function formatNumber(num) {
            return new Intl.NumberFormat('de-DE', { 
                minimumFractionDigits: 2, 
                maximumFractionDigits: 2 
            }).format(num);
        }
        
        function setFavorite(from, to) { fromSelect.value = from; toSelect.value = to; fetchRate(); }
        
        async function fetchRate() {
            const amount = parseFloat(amountInput.value);
            const from = fromSelect.value;
            const to = toSelect.value;
            
            if (isNaN(amount) || amount === 0) { 
                resultAmount.innerText = "0,00"; 
                wiseFeeText.innerText = "";
                return; 
            }
            
            resultBox.classList.add('loading');
            errorMsg.style.display = 'none';
            try {
                let finalResult;
                if (from === to) { finalResult = amount; } else {
                    const response = await fetch(`https://api.frankfurter.app/latest?amount=${amount}&from=${from}&to=${to}`);
                    if (!response.ok) throw new Error('API Error');
                    const data = await response.json();
                    finalResult = data.rates[to];
                }
                updateUI(amount, finalResult, from, to);
                addToHistory(amount, finalResult, from, to);
            } catch (error) { 
                console.error(error); 
                errorMsg.style.display = 'block'; 
                resultAmount.innerText = "---"; 
                wiseFeeText.innerText = "";
            } finally { 
                resultBox.classList.remove('loading'); 
            }
        }

        function updateUI(original, converted, from, to) {
            // Original-Betrag auch formatieren
            conversionText.innerText = `${formatNumber(original)} ${from} =`;
            
            // Ergebnis formatieren
            resultAmount.innerText = `${formatNumber(converted)} ${to}`;

            // Wise-Berechnung (0,58% Abzug)
            const amountWithFee = converted * 0.9942;
            
            wiseFeeText.innerText = `ca. mit Wise: ${formatNumber(amountWithFee)} ${to}`;
        }

        function addToHistory(amount, result, from, to) {
            // Auch in der History formatieren wir nun beide Werte strikt
            const amountStr = formatNumber(amount);
            const resultStr = formatNumber(result);
            
            // Um Duplikate zu vermeiden, speichern wir intern die Rohwerte, aber anzeigen tun wir formatiert
            // Wir pr√ºfen nur grob auf √Ñnderung, um Spam zu vermeiden
            if (conversionHistory.length > 0) { 
                const last = conversionHistory[0]; 
                // Vergleich auf Basis der Rohwerte (Eingabe)
                if (last.from === from && last.to === to && last.rawAmount === amount) return; 
            }
            
            const newEntry = { 
                from, 
                to, 
                rawAmount: amount, // Zum Vergleichen
                displayAmount: amountStr, 
                result: resultStr, 
                time: new Date().toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' }) 
            };
            
            conversionHistory.unshift(newEntry);
            if (conversionHistory.length > 5) conversionHistory.pop();
            localStorage.setItem('fx_history', JSON.stringify(conversionHistory));
            renderHistory();
        }

        function renderHistory() {
            historyListEl.innerHTML = '';
            conversionHistory.forEach(item => {
                const li = document.createElement('li');
                li.className = 'history-item';
                // Hier werden die formatierten Strings genutzt
                // Falls alte Daten im LocalStorage sind ohne 'displayAmount', Fallback nutzen
                const displayAmt = item.displayAmount || formatNumber(item.rawAmount || parseFloat(item.amount));
                
                li.innerHTML = `<span class="history-values">${displayAmt} ${item.from} &#8594; ${item.result} ${item.to}</span><span class="history-date">${item.time}</span>`;
                historyListEl.appendChild(li);
            });
        }

        function onInputChanged() { clearTimeout(debounceTimer); debounceTimer = setTimeout(fetchRate, 600); }
        
        amountInput.addEventListener('input', onInputChanged);
        fromSelect.addEventListener('change', fetchRate);
        toSelect.addEventListener('change', fetchRate);
        swapBtn.addEventListener('click', () => { const temp = fromSelect.value; fromSelect.value = toSelect.value; toSelect.value = temp; fetchRate(); });
        
        renderHistory(); fetchRate();
    </script>
</body>
</html>
